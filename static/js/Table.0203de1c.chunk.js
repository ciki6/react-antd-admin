(this.webpackJsonpreact_antd_admin=this.webpackJsonpreact_antd_admin||[]).push([[27],{1472:function(e,t,a){"use strict";a.r(t);a(827);var n=a(835),i=a.n(n),l=(a(243),a(117)),r=a.n(l),c=(a(241),a(171)),s=a.n(c),o=(a(89),a(67)),u=a.n(o),d=(a(620),a(604)),m=a.n(d),h=(a(239),a(95)),f=a.n(h),b=(a(240),a(133)),p=a.n(b),g=(a(130),a(51)),E=a.n(g),y=a(11),O=a(53),v=a(54),w=a(66),S=a(65),C=(a(678),a(679)),j=a.n(C),k=(a(602),a(603)),D=a.n(k),M=a(0),I=a.n(M),Q=a(1476),V=a(1449),Y=a(1450),z=a(48);function R(e){return Object(z.a)({url:"/table/list",method:"post",data:e})}function _(e){return Object(z.a)({url:"/table/delete",method:"post",data:e})}function x(e){return Object(z.a)({url:"/table/edit",method:"post",data:e})}a(172);var L=a(106),H=a.n(L),P=(a(1387),a(1396)),N=a.n(P),F=(a(1389),a(1392)),T=a.n(F),J=a(734),q=a.n(J);a(1391);q.a.locale("zh-cn");var A=function(e){Object(w.a)(a,e);var t=Object(S.a)(a);function a(){return Object(O.a)(this,a),t.apply(this,arguments)}return Object(v.a)(a,[{key:"render",value:function(){var e=this.props,t=e.visible,a=e.onCancel,n=e.onOk,i=e.form,l=e.confirmLoading,r=e.currentRowData,c=i.getFieldDecorator,s=r.id,o=r.author,u=r.date,d=r.readings,h=r.star,b=r.status,g=r.title,E={labelCol:{sm:{span:4}},wrapperCol:{sm:{span:16}}};return I.a.createElement(H.a,{title:"\u7f16\u8f91",visible:t,onCancel:a,onOk:n,confirmLoading:l},I.a.createElement(f.a,E,I.a.createElement(f.a.Item,{label:"\u5e8f\u53f7:"},c("id",{initialValue:s})(I.a.createElement(p.a,{disabled:!0}))),I.a.createElement(f.a.Item,{label:"\u6807\u9898:"},c("title",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6807\u9898!"}],initialValue:g})(I.a.createElement(p.a,{placeholder:"\u6807\u9898"}))),I.a.createElement(f.a.Item,{label:"\u4f5c\u8005:"},c("author",{initialValue:o})(I.a.createElement(p.a,{disabled:!0}))),I.a.createElement(f.a.Item,{label:"\u9605\u8bfb\u91cf:"},c("readings",{initialValue:d})(I.a.createElement(p.a,{disabled:!0}))),I.a.createElement(f.a.Item,{label:"\u63a8\u8350\u6307\u6570:"},c("star",{initialValue:h.length})(I.a.createElement(T.a,{count:3}))),I.a.createElement(f.a.Item,{label:"\u72b6\u6001:"},c("status",{initialValue:b})(I.a.createElement(m.a,{style:{width:120}},I.a.createElement(m.a.Option,{value:"published"},"published"),I.a.createElement(m.a.Option,{value:"draft"},"draft")))),I.a.createElement(f.a.Item,{label:"\u65f6\u95f4:"},c("date",{rules:[{type:"object",required:!0,message:"\u8bf7\u9009\u62e9\u65f6\u95f4!"}],initialValue:q()(u||"YYYY-MM-DD HH:mm:ss")})(I.a.createElement(N.a,{showTime:!0,format:"YYYY-MM-DD HH:mm:ss"})))))}}]),a}(M.Component),K=f.a.create({name:"EditForm"})(A),U=D.a.Column,W=j.a.Panel,B=function(e){Object(w.a)(a,e);var t=Object(S.a)(a);function a(){var e;Object(O.a)(this,a);for(var n=arguments.length,i=new Array(n),l=0;l<n;l++)i[l]=arguments[l];return(e=t.call.apply(t,[this].concat(i)))._isMounted=!1,e.state={list:[],loading:!1,total:0,listQuery:{pageNumber:1,pageSize:10,title:"",star:"",status:""},editModalVisible:!1,editModalLoading:!1,currentRowData:{id:0,author:"",date:"",readings:0,star:"\u2605",status:"published",title:""}},e.fetchData=function(){e.setState({loading:!0}),R(e.state.listQuery).then((function(t){e.setState({loading:!1});var a=t.data.data.items,n=t.data.data.total;e._isMounted&&e.setState({list:a,total:n})}))},e.filterTitleChange=function(t){var a=t.target.value;e.setState((function(e){return{listQuery:Object(y.a)(Object(y.a)({},e.listQuery),{},{title:a})}}))},e.filterStatusChange=function(t){e.setState((function(e){return{listQuery:Object(y.a)(Object(y.a)({},e.listQuery),{},{status:t})}}))},e.filterStarChange=function(t){e.setState((function(e){return{listQuery:Object(y.a)(Object(y.a)({},e.listQuery),{},{star:t})}}))},e.changePage=function(t,a){e.setState((function(e){return{listQuery:Object(y.a)(Object(y.a)({},e.listQuery),{},{pageNumber:t})}}),(function(){e.fetchData()}))},e.changePageSize=function(t,a){e.setState((function(e){return{listQuery:Object(y.a)(Object(y.a)({},e.listQuery),{},{pageNumber:1,pageSize:a})}}),(function(){e.fetchData()}))},e.handleDelete=function(t){_({id:t.id}).then((function(t){E.a.success("\u5220\u9664\u6210\u529f"),e.fetchData()}))},e.handleEdit=function(t){e.setState({currentRowData:Object.assign({},t),editModalVisible:!0})},e.handleOk=function(t){var a=e.formRef.props.form;a.validateFields((function(t,n){if(!t){var i=Object(y.a)(Object(y.a)({},n),{},{star:"".padStart(n.star,"\u2605"),date:n.date.format("YYYY-MM-DD HH:mm:ss")});e.setState({editModalLoading:!0}),x(i).then((function(t){a.resetFields(),e.setState({editModalVisible:!1,editModalLoading:!1}),E.a.success("\u7f16\u8f91\u6210\u529f!"),e.fetchData()})).catch((function(e){E.a.success("\u7f16\u8f91\u5931\u8d25,\u8bf7\u91cd\u8bd5!")}))}}))},e.handleCancel=function(t){e.setState({editModalVisible:!1})},e}return Object(v.a)(a,[{key:"componentDidMount",value:function(){this._isMounted=!0,this.fetchData()}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"render",value:function(){var e=this;return I.a.createElement("div",{className:"app-container"},I.a.createElement(j.a,{defaultActiveKey:["1"]},I.a.createElement(W,{header:"\u7b5b\u9009",key:"1"},I.a.createElement(f.a,{layout:"inline"},I.a.createElement(f.a.Item,{label:"\u6807\u9898:"},I.a.createElement(p.a,{onChange:this.filterTitleChange})),I.a.createElement(f.a.Item,{label:"\u7c7b\u578b:"},I.a.createElement(m.a,{style:{width:120},onChange:this.filterStatusChange},I.a.createElement(m.a.Option,{value:"published"},"published"),I.a.createElement(m.a.Option,{value:"draft"},"draft"))),I.a.createElement(f.a.Item,{label:"\u63a8\u8350\u6307\u6570:"},I.a.createElement(m.a,{style:{width:120},onChange:this.filterStarChange},I.a.createElement(m.a.Option,{value:1},"\u2605"),I.a.createElement(m.a.Option,{value:2},"\u2605\u2605"),I.a.createElement(m.a.Option,{value:3},"\u2605\u2605\u2605"))),I.a.createElement(f.a.Item,null,I.a.createElement(u.a,{type:"primary",icon:I.a.createElement(Q.a,null),onClick:this.fetchData},"\u641c\u7d22"))))),I.a.createElement("br",null),I.a.createElement(D.a,{bordered:!0,rowKey:function(e){return e.id},dataSource:this.state.list,loading:this.state.loading,pagination:!1},I.a.createElement(U,{title:"\u5e8f\u53f7",dataIndex:"id",key:"id",width:200,align:"center",sorter:function(e,t){return e.id-t.id}}),I.a.createElement(U,{title:"\u6807\u9898",dataIndex:"title",key:"title",width:200,align:"center"}),I.a.createElement(U,{title:"\u4f5c\u8005",dataIndex:"author",key:"author",width:100,align:"center"}),I.a.createElement(U,{title:"\u9605\u8bfb\u91cf",dataIndex:"readings",key:"readings",width:195,align:"center"}),I.a.createElement(U,{title:"\u63a8\u8350\u6307\u6570",dataIndex:"star",key:"star",width:195,align:"center"}),I.a.createElement(U,{title:"\u72b6\u6001",dataIndex:"status",key:"status",width:195,align:"center",render:function(e){var t="published"===e?"green":"deleted"===e?"red":"";return I.a.createElement(s.a,{color:t,key:e},e)}}),I.a.createElement(U,{title:"\u65f6\u95f4",dataIndex:"date",key:"date",width:195,align:"center"}),I.a.createElement(U,{title:"\u64cd\u4f5c",key:"action",width:195,align:"center",render:function(t,a){return I.a.createElement("span",null,I.a.createElement(u.a,{type:"primary",shape:"circle",icon:I.a.createElement(V.a,null),title:"\u7f16\u8f91",onClick:e.handleEdit.bind(null,a)}),I.a.createElement(r.a,{type:"vertical"}),I.a.createElement(u.a,{type:"primary",shape:"circle",icon:I.a.createElement(Y.a,null),title:"\u5220\u9664",onClick:e.handleDelete.bind(null,a)}))}})),I.a.createElement("br",null),I.a.createElement(i.a,{total:this.state.total,pageSizeOptions:["10","20","40"],showTotal:function(e){return"\u5171".concat(e,"\u6761\u6570\u636e")},onChange:this.changePage,current:this.state.listQuery.pageNumber,onShowSizeChange:this.changePageSize,showSizeChanger:!0,showQuickJumper:!0,hideOnSinglePage:!0}),I.a.createElement(K,{currentRowData:this.state.currentRowData,wrappedComponentRef:function(t){return e.formRef=t},visible:this.state.editModalVisible,confirmLoading:this.state.editModalLoading,onCancel:this.handleCancel,onOk:this.handleOk}))}}]),a}(M.Component);t.default=B}}]);